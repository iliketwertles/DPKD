import strformat
import os
import osproc
import strutils
import terminal

proc Distro(): string =
  when defined(Linux):
    var info = io.readLines("/etc/os-release", 3)
    ansiForegroundColorCode(fgCyan) & capitalizeAscii(info[2].replace("ID=", "")) & ansiResetCode
  elif defined(MacOS) or defined(MacOSX):
    ansiForegroundColorCode(fgCyan) & "MacOS" & ansiResetCode

proc Packages(): string =
  when defined(Linux):
    if existsFile("/etc/pacman.conf"):
      return ansiForegroundColorCode(fgBlue) & execProcess("pacman -Q | wc -l").strip & ansiResetCode
    elif dirExists("/etc/apt"):
      return ansiForegroundColorCode(fgBlue) & execProcess("dpkg -l | wc -l").strip & ansiResetCode
    elif dirExists("/etc/dnf"):
      return ansiForegroundColorCode(fgBlue) & execProcess("rpm -qa | wc -l").strip & ansiResetCode
  elif defined(MacOS) or defined(MacOSX):
    ansiForegroundColorCode(fgBlue) & execProcess("brew list | wc -l") & ansiResetCode

proc Kernel(): string =
  when defined(Linux) or defined(MacOS) or defined(MacOSX): 
    let kernel = execProcess("uname -r").strip
    ansiForegroundColorCode(fgYellow) & kernel & ansiResetCode

proc Desktop(): string =
  when defined(Linux):
    if getEnv("XDG_CURRENT_DESKTOP") == "":
      ansiForegroundColorCode(fgRed) & capitalizeAscii(getEnv("DESKTOP_SESSION")) & ansiResetCode 
    else:
      ansiForegroundColorCode(fgRed) & getEnv("XDG_CURRENT_DESKTOP") & ansiResetCode
  elif defined(Macos) or defined(MacOSX):
    return ansiForegroundColorCode(fgRed) & "Finder" & ansiResetCode

#prompt
when defined(Linux) or defined(MacOS) or defined(MacOSX):
  let p = ansiForegroundColorCode(fgGreen) & "C>_" & ansiResetCode

var ascii = fmt("""
   .----.
   |{p} |     Distro: {Distro()}
 __|____|__   Packages: {Packages()}
|  ______--|  Kernel: {Kernel()}
`-/.::::.\-'a Desktop: {Desktop()}
 `--------'""")
echo ascii
