import strformat
import os
import osproc
import strutils
import terminal

proc Distro(): string =
   var info = io.readLines("/etc/os-release", 3)
   return ansiForegroundColorCode(fgCyan) & capitalizeAscii(info[2].replace("ID=", "")) & ansiResetCode

proc Packages(): string =
   if existsFile("/etc/pacman.conf"):
      return ansiForegroundColorCode(fgBlue) & execProcess("pacman -Q | wc -l").strip & ansiResetCode
   elif dirExists("/etc/apt"):
      return ansiForegroundColorCode(fgBlue) & execProcess("dpkg -l | wc -l").strip & ansiResetCode
   elif dirExists("/etc/dnf"):
      return ansiForegroundColorCode(fgBlue) & execProcess("rpm -qa | wc -l").strip & ansiResetCode

proc Kernel(): string =
   let kernel = execProcess("uname -r").strip
   return ansiForegroundColorCode(fgYellow) & kernel & ansiResetCode

proc Desktop(): string =
   if getEnv("XDG_CURRENT_DESKTOP") == "":
      return ansiForegroundColorCode(fgRed) & capitalizeAscii(getEnv("DESKTOP_SESSION")) & ansiResetCode 
   else:
      return ansiForegroundColorCode(fgRed) & getEnv("XDG_CURRENT_DESKTOP") & ansiResetCode

#prompt
let p = ansiForegroundColorCode(fgGreen) & "C>_" & ansiResetCode

var ascii = fmt("""
   .----.
   |{p} |     Distro: {Distro()}
 __|____|__   Packages: {Packages()}
|  ______--|  Kernel: {Kernel()}
`-/.::::.\-'a Desktop: {Desktop()}
 `--------'""")
echo ascii
